<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>晟自然輔助系統　靜電實驗室</title>
    
    <style>
        /* --- 1. 系統變數 --- */
        :root {
            --primary-dark: #0b1016;
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            /* V7 改版：高能光譜漸層 */
            --energy-gradient: linear-gradient(90deg, #005bea 0%, #00c6fb 50%, #ffffff 100%);
            --header-h: 60px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--primary-dark);
            background-image: url('page.jpg'); 
            background-size: cover;
            background-position: center;
            overflow: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
            color: #fff;
            cursor: crosshair; 
        }

        /* --- 2. 背景特效層 --- */
        #storm-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(10,15,30,0.85), rgba(0,0,0,0.95));
            z-index: 1;
        }
        
        #bg-lightning-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; 
            pointer-events: none;
            opacity: 0.9;
            mix-blend-mode: screen; 
        }

        #lightning-flash {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 30%, rgba(200, 220, 255, 0.5), transparent 80%);
            opacity: 0; 
            z-index: 3;
            pointer-events: none;
            mix-blend-mode: overlay;
            transition: opacity 0.05s ease-out; 
        }

        /* --- 3. 標題列 --- */
        header {
            position: absolute; top: 0; left: 0; width: 100%;
            height: var(--header-h);
            display: flex; align-items: center;
            padding: 0 20px;
            z-index: 10;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        .logo-img { height: 32px; margin-right: 15px; border-radius: 4px; box-shadow: 0 0 10px rgba(0,243,255,0.3); }
        .title-text { font-size: 1.2rem; letter-spacing: 2px; font-weight: 600; color: #e0faff; }

        /* --- 4. 前景互動畫布 --- */
        #canvas-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 25; 
            pointer-events: none; 
        }

        /* --- 5. UI 容器 --- */
        #ui-container {
            position: relative;
            z-index: 20;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 35px;
            padding-top: 40px;
        }

        .hint-text {
            color: rgba(100, 200, 255, 0.8);
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
            animation: textBreath 2s infinite ease-in-out;
        }

        @keyframes textBreath {
            0%, 100% { opacity: 0.6; transform: scale(0.98); }
            50% { opacity: 1; transform: scale(1.02); }
        }

        /* --- 6. 萊頓瓶裝置按鈕 --- */
        .capacitor-btn {
            position: relative;
            width: 340px;
            height: 110px;
            background: rgba(10, 15, 20, 0.7); 
            border: 2px solid #4a5568;
            border-radius: 6px; 
            overflow: hidden;
            cursor: grab;
            transition: transform 0.05s linear;
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.6), inset 0 0 30px rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
        }

        .capacitor-btn::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 4px;
            pointer-events: none;
            z-index: 10;
        }

        /* 能量條：由左至右 + 漸層 */
        .plasma-fill {
            position: absolute;
            top: 0; left: 0;       
            width: 0%;             
            height: 100%;          
            background: var(--energy-gradient);
            box-shadow: 0 0 40px var(--neon-blue);
            z-index: 1;
            transition: width 0.05s linear; 
            filter: brightness(1.1);
            border-right: 3px solid #fff;
        }
        
        /* 過載狀態 */
        .capacitor-btn.overload .plasma-fill {
            background: #fff;
            filter: brightness(2) drop-shadow(0 0 20px #fff);
            width: 100% !important; /* 強制全滿 */
        }

        .btn-content {
            position: relative; z-index: 5;
            display: flex; flex-direction: column; align-items: flex-start;
            width: 100%; padding: 0 30px;
            pointer-events: none;
            text-shadow: 0 2px 5px rgba(0,0,0,0.9);
        }

        .btn-title { font-size: 1.4rem; font-weight: 800; color: #fff; letter-spacing: 1px; }
        .btn-desc { font-size: 0.85rem; color: #a0aec0; margin-top: 5px; font-family: monospace; }
        
        .voltage-readout {
            position: absolute; top: 12px; right: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--neon-blue);
            z-index: 15;
            text-shadow: 0 0 5px var(--neon-blue);
        }

        /* --- 7. 全白閃光層 --- */
        #flash-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 999; opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease-out; 
        }

        @media (max-width: 600px) {
            .capacitor-btn { width: 90%; height: 95px; }
            .btn-title { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <header>
        <img src="logo.jpg" class="logo-img" alt="Logo">
        <span class="title-text">晟自然輔助系統　靜電實驗室</span>
    </header>

    <div id="storm-bg"></div>
    <canvas id="bg-lightning-canvas"></canvas>
    <div id="lightning-flash"></div>

    <canvas id="canvas-layer"></canvas>

    <div id="ui-container">
        <div class="hint-text">WARNING: ENERGY LOW<br>請快速摩擦電容槽充能</div>

        <div class="capacitor-btn" id="btn-A" data-target="專案A - 靜電感應.html">
            <div class="plasma-fill"></div>
            <div class="voltage-readout">00%</div>
            <div class="btn-content">
                <span class="btn-title">PROJECT A</span>
                <span class="btn-desc">靜電感應</span>
            </div>
        </div>

        <div class="capacitor-btn" id="btn-B" data-target="專案B - 感應起電.html">
            <div class="plasma-fill"></div>
            <div class="voltage-readout">00%</div>
            <div class="btn-content">
                <span class="btn-title">PROJECT B</span>
                <span class="btn-desc">感應起電</span>
            </div>
        </div>

        <div class="capacitor-btn" id="btn-C" data-target="專案C - 接觸起電.html">
            <div class="plasma-fill"></div>
            <div class="voltage-readout">00%</div>
            <div class="btn-content">
                <span class="btn-title">PROJECT C</span>
                <span class="btn-desc">接觸起電</span>
            </div>
        </div>
    </div>

    <div id="flash-layer"></div>

    <script>
        // =========================================================
        // 晟自然 - 雷電實驗室 V8 (Perfect Feel & Instant Jump)
        // =========================================================

        const CONFIG = {
            // ★ 手感調教重點：更慢的充能，更慢的耗能，更有重量感
            frictionGain: 0.08,      // 摩擦獲得能量 (調低，變難充)
            baseDecay: 0.05,         // 基礎自然流失 (調低，電量較持久)
            maxDecay: 0.4,           // 最大流失速度 (調低，防止瞬間歸零)
            
            arcThreshold: 3,         
            maxCharge: 100
        };

        const buttons = [
            { 
                id: 'btn-A', charge: 0, 
                el: document.getElementById('btn-A'), 
                fillEl: document.getElementById('btn-A').querySelector('.plasma-fill'),
                textEl: document.getElementById('btn-A').querySelector('.voltage-readout'),
                shake: 0 
            },
            { 
                id: 'btn-B', charge: 0, 
                el: document.getElementById('btn-B'), 
                fillEl: document.getElementById('btn-B').querySelector('.plasma-fill'),
                textEl: document.getElementById('btn-B').querySelector('.voltage-readout'),
                shake: 0 
            },
            { 
                id: 'btn-C', charge: 0, 
                el: document.getElementById('btn-C'), 
                fillEl: document.getElementById('btn-C').querySelector('.plasma-fill'),
                textEl: document.getElementById('btn-C').querySelector('.voltage-readout'),
                shake: 0 
            }
        ];

        let state = {
            lastX: 0, lastY: 0,
            isRedirecting: false, // 全域鎖定標記
            frame: 0
        };

        const canvas = document.getElementById('canvas-layer');
        const ctx = canvas.getContext('2d');
        const bgCanvas = document.getElementById('bg-lightning-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        const bgFlash = document.getElementById('lightning-flash');
        
        let arcs = [];
        let bgBolts = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- 1. 閃電算法 ---
        function drawLightningBranch(ctx, x1, y1, x2, y2, displace, width, color) {
            if (displace < 2) {
                ctx.lineWidth = width;
                ctx.strokeStyle = color;
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                return;
            }
            let midX = (x1 + x2) / 2;
            let midY = (y1 + y2) / 2;
            midX += (Math.random() - 0.5) * displace;
            midY += (Math.random() - 0.5) * displace;
            
            drawLightningBranch(ctx, x1, y1, midX, midY, displace / 2, width, color);
            drawLightningBranch(ctx, midX, midY, x2, y2, displace / 2, width, color);
            
            if (Math.random() < 0.3 && width > 0.5) {
                let branchX = midX + (Math.random() - 0.5) * displace * 2;
                let branchY = midY + (Math.random() * displace);
                drawLightningBranch(ctx, midX, midY, branchX, branchY, displace / 1.5, width * 0.6, color);
            }
        }

        // --- 2. 背景雷擊 (高頻率) ---
        class SkyBolt {
            constructor() {
                this.x = Math.random() * window.innerWidth;
                this.y = -50; 
                this.tx = this.x + (Math.random() - 0.5) * 400;
                this.ty = window.innerHeight * (0.6 + Math.random() * 0.4); 
                this.life = 8; 
                this.opacity = 1;
            }
            draw() {
                if (this.life > 0) {
                    bgCtx.shadowBlur = 30;
                    bgCtx.shadowColor = "#fff";
                    bgCtx.globalAlpha = this.opacity;
                    drawLightningBranch(bgCtx, this.x, this.y, this.tx, this.ty, 120, 2.5, "#ffffff");
                    bgCtx.globalAlpha = 1;
                    this.life--;
                    this.opacity -= 0.15;
                }
            }
        }

        class Arc {
            constructor(sx, sy, tx, ty, power) {
                this.sx = sx; this.sy = sy; 
                this.tx = tx; this.ty = ty; 
                this.life = 2 + Math.random() * 3; 
                this.color = Math.random() > 0.3 ? '#00f3ff' : '#ffffff';
                this.width = Math.min(3, power / 8);
            }
            draw(ctx) {
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                drawLightningBranch(ctx, this.sx, this.sy, this.tx, this.ty, 40, this.width, this.color);
                this.life--;
            }
        }

        // --- 3. 互動核心 (V8 Update) ---
        function handleInput(x, y) {
            // 如果正在跳轉中，完全鎖死，不接受任何輸入，也不會進行衰減
            if (state.isRedirecting) return;
            
            const dx = x - state.lastX;
            const dy = y - state.lastY;
            const dist = Math.sqrt(dx*dx + dy*dy);

            const targetEl = document.elementFromPoint(x, y);
            if (targetEl) {
                const btnEl = targetEl.closest('.capacitor-btn');
                if (btnEl) {
                    const btnData = buttons.find(b => b.el === btnEl);
                    if (btnData && dist > CONFIG.arcThreshold) {
                        
                        // 充能公式
                        let gain = dist * CONFIG.frictionGain;
                        btnData.charge += gain;
                        
                        // ★ V8 關鍵邏輯：一旦達到 100，直接觸發，不需要等 Frame Loop
                        if (btnData.charge >= CONFIG.maxCharge) {
                            btnData.charge = CONFIG.maxCharge;
                            // 立即觸發過載，不需要放手
                            triggerOverload(btnData); 
                            return; // 結束函式，不再做後續處理
                        }

                        // 產生電弧
                        const rect = btnEl.getBoundingClientRect();
                        const tx = rect.left + Math.random() * rect.width;
                        const ty = rect.top + Math.random() * rect.height;
                        arcs.push(new Arc(x, y, tx, ty, dist));
                        
                        btnData.shake = Math.min(8, dist / 3);
                    }
                }
            }
            state.lastX = x; state.lastY = y;
        }

        window.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY));
        window.addEventListener('touchmove', e => {
            e.preventDefault();
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });
        window.addEventListener('mousedown', e => { state.lastX = e.clientX; state.lastY = e.clientY; });
        window.addEventListener('touchstart', e => { state.lastX = e.touches[0].clientX; state.lastY = e.touches[0].clientY; });

        function updateBackgroundStorm() {
            if (Math.random() < 0.03) { 
                bgBolts.push(new SkyBolt());
                bgFlash.style.opacity = 0.6;
                setTimeout(() => { bgFlash.style.opacity = 0; }, 100);
            } 
        }

        // --- 4. 主迴圈 ---
        function loop() {
            state.frame++;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            
            updateBackgroundStorm();

            // 繪製背景雷擊
            for (let i = bgBolts.length - 1; i >= 0; i--) {
                bgBolts[i].draw();
                if (bgBolts[i].life <= 0) bgBolts.splice(i, 1);
            }

            // 更新按鈕
            buttons.forEach(btn => {
                // ★ V8 重點：如果正在跳轉(Redirecting)，這裡完全不執行衰減
                // 這就實現了您說的「充能與能量消失中間的間隔」——事實上是永久停止消失，直到跳轉。
                if (state.isRedirecting) {
                    // 保持過載視覺狀態
                    if (btn.charge >= 100) {
                         btn.fillEl.style.width = '100%';
                         btn.el.style.transform = `scale(1.05)`;
                    }
                    return; 
                }

                // 正常衰減邏輯 (變慢了)
                if (btn.charge > 0) {
                    let decay = CONFIG.baseDecay + (btn.charge * 0.005); 
                    if (decay > CONFIG.maxDecay) decay = CONFIG.maxDecay;
                    
                    btn.charge -= decay;
                    if (btn.charge < 0) btn.charge = 0;
                }

                // 更新畫面
                btn.fillEl.style.width = `${btn.charge}%`;
                btn.textEl.innerText = `${Math.floor(btn.charge)}%`;
                
                if (btn.charge > 80) {
                    btn.el.style.borderColor = "#fff";
                    btn.el.style.boxShadow = `0 0 ${btn.charge}px rgba(255,255,255,0.4)`;
                } else {
                    btn.el.style.borderColor = "#4a5568";
                    btn.el.style.boxShadow = "none";
                }

                if (btn.shake > 0) {
                    const dx = (Math.random() - 0.5) * btn.shake;
                    const dy = (Math.random() - 0.5) * btn.shake;
                    btn.el.style.transform = `translate(${dx}px, ${dy}px)`;
                    btn.shake *= 0.85; 
                } else {
                    btn.el.style.transform = `translate(0, 0)`;
                }
            });

            // 繪製游標電弧
            for (let i = arcs.length - 1; i >= 0; i--) {
                const arc = arcs[i];
                arc.draw(ctx);
                if (arc.life <= 0) arcs.splice(i, 1);
            }

            requestAnimationFrame(loop);
        }

        // --- 5. 觸發跳轉 (Instant Trigger) ---
        function triggerOverload(btnData) {
            // 防止重複觸發
            if (state.isRedirecting) return;
            state.isRedirecting = true; // ★ 鎖定系統，禁止衰減
            
            // 視覺過載 (強制設定)
            btnData.charge = 100;
            btnData.el.classList.add('overload');
            btnData.fillEl.style.width = '100%'; 
            btnData.textEl.innerText = "LAUNCH";
            
            // 瞬間白屏
            const flash = document.getElementById('flash-layer');
            flash.style.opacity = 1;
            
            // ★ V8 重點：縮短延遲至 0.1秒 (100ms)，幾乎是瞬間跳轉
            setTimeout(() => {
                const targetUrl = btnData.el.getAttribute('data-target');
                window.open(targetUrl, '_blank');
                
                // 跳轉後，稍微再等一下才重置，讓使用者回來時感覺是新的開始
                setTimeout(() => resetSystem(btnData), 500);
                
            }, 100); 
        }

        function resetSystem(btnData) {
            const flash = document.getElementById('flash-layer');
            flash.style.opacity = 0;

            btnData.charge = 0;
            btnData.el.classList.remove('overload');
            btnData.el.style.transform = `scale(1.0)`;
            btnData.fillEl.style.width = '0%';
            btnData.textEl.innerText = "0%";
            btnData.el.style.borderColor = "#4a5568";
            btnData.el.style.boxShadow = "none";

            state.isRedirecting = false; // 解除鎖定
        }

        // Start
        loop();

    </script>
</body>
</html>